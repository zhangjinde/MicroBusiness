window.Utils=window.Utils||{},$.extend(window.Utils,{getWxInfo:function(){var t=window.navigator.userAgent,e=t.match(/MicroMessenger\/(\d+(\.\d+)*)/),i=null!==e&&e.length,n=i?parseFloat(e[1]):0;return{isWx:i,wxVersion:n}}}),define("wap/components/util/wx_info",function(){}),define("text!wap/showcase/goods/templates/goodsCount.html",[],function(){return'<% if ( data.day > 0 ) { %>\n<i class="mc-num-days"><%- (+data.day) %></i><span class="mc-text">天</span>\n<% } %>\n<% if ( data.day > 0 || data.hour > 0 ) { %>\n<i class="mc-num-hours"><%- (+data.hour) %></i><span class="mc-text">小时</span>\n<% } %>\n<i class="mc-num-minutes"><%- data.min %></i><span class="mc-text">分</span>\n<i class="mc-num-seconds"><%- data.sec %></i><span class="mc-text">秒</span>'}),define("components/zenjs/util/count_down",[],function(){function t(t,e,i,n,s){var o=0,a=0,r=0,d=0,l=0,c="",h=new Date,u=t.getTime()-h.getTime();return 0>=u?(s.stop(),e({seconds:0,text:"00:00:000",hour:0,min:0,sec:0,msec:0,day:0}),void i()):(u>864e5&&(o=Math.floor(u/864e5),u-=864e5*o,c+=o+"天"),u>36e5&&(a=u>36e6?Math.floor(u/36e5):"0"+Math.floor(u/36e5),u-=36e5*a,c+=a+"小时"),u>6e4?(r=Math.floor(u/6e4)%60,d=Math.floor(u/1e3)%60,l=u%1e3):(r=0,d=Math.floor(u/1e3),l=u%1e3),10>r&&(c+="0"),c+=r+"分",10>d&&(c+="0"),c+=d+"秒",10>l?c+="00":100>l&&(c+="0"),"second"!=n&&(c+=l),void e({text:c,hour:a,min:r,sec:d,msec:l,day:o}))}function e(){this.tid=null,this.startTime=null}var i=function(){};return e.prototype={run:function(e){function n(){d.tid=setTimeout(n,"second"==e.step?1e3:50),t(r,o,a,e.step,d)}this.startTime||(this.startTime=Date.now());var s=e.seconds||0,o=e.onTimeChange||i,a=e.onTimeChangeEnd||i;this.startTime+=1e3*s;var r=new Date(this.startTime),d=this;n()},stop:function(){clearTimeout(this.tid)}},e}),window.Utils=window.Utils||{},$.extend(window.Utils,{makeRandomString:function(t){var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var n=0;t>n;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}}),define("wap/components/util/number",function(){}),define("wap/components/pop",["components/zenjs/events","wap/components/util/number"],function(t){var e=function(){};window.zenjs=window.zenjs||{};var i=t.extend({init:function(t){this._window=$(window);var i=window.Utils.makeRandomString();$("body").append('<div id="'+i+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(t.transparent||".9")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+i),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var n=window.Utils.makeRandomString();$("body").append('<div id="'+n+'" class="'+(t.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+n),this.nPopContainer.hide(),t.contentViewClass&&(this.contentViewClass=t.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},t.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions))),this.animationTime=t.animationTime||300,this.isCanNotHide=t.isCanNotHide,this.doNotRemoveOnHide=t.doNotRemoveOnHide||!1,this.onShow=t.onShow||e,this.onHide=t.onHide||e,this.onFinishHide=t.onFinishHide||e,this.html=t.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.top=this._window.scrollTop(),this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),setTimeout($.proxy(function(){this._window.scrollTop(0),this.startShow(),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(){var t,e=function(){return t!==this._window.scrollTop()?(this._window.scrollTop(t),void setTimeout($.proxy(e,this))):void setTimeout($.proxy(this.onFinishHide,this),50)};return function(i){i=i||{};var n=i.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),setTimeout($.proxy(function(){this.startHide(),t=this.top,this._window.scrollTop(t),$.proxy(e,this)(),this.nBg.css({opacity:0,"transition-property":"opacity"}),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),n||this.destroy(),$("html").css("position","static")},this),200)},this),this.animationTime),this.onHide()}}(),destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this},startShow:function(){var t=window.zenjs.popList;t||(t=window.zenjs.popList=[]),t.indexOf(this)<0&&(t.push(this),$("body,html").css({overflow:"hidden",height:this._window.height()}),$("html").css("position","relative"))},startHide:function(){var t=window.zenjs.popList,e=t.indexOf(this);e>-1&&t.splice(e,1),t.length<1&&($("html,body").css({overflow:"visible",height:"auto"}),$("html").css("position","static"))}});return i}),define("wap/components/popup",["wap/components/pop"],function(t){var e=t.extend({init:function(t){this._super(t),this.onClickBg=t.onClickBg||function(){},this.onBeforePopupShow=t.onBeforePopupShow||function(){},this.onAfterPopupHide=t.onAfterPopupHide||function(){},this.nPopContainer.css(_.extend({left:0,right:0,bottom:0,background:"white"},t.containerCss||{})),this.nPopContainer.css("opacity","0")},_doShow:function(){this.contentView&&this.contentView.height?this.height=this.contentView.height():this.contentView||(this.height=this.nPopContainer.height()),this.onBeforePopupShow(),$(".js-popup-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css({height:this.height+"px",transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)",opacity:0,position:"absolute","z-index":1e3}),this.bodyPadding=$("body").css("padding"),$("body").css("padding","0px"),setTimeout($.proxy(function(){this.nPopContainer.css({transform:"translate3d(0,0,0)","-webkit-transform":"translate3d(0,0,0)","-webkit-transition":"all ease "+this.animationTime+"ms",transition:"all ease "+this.animationTime+"ms",opacity:1})},this)),setTimeout($.proxy(function(){this.contentView&&this.contentView.onAfterPopupShow&&this.contentView.onAfterPopupShow()},this),this.animationTime)},_doHide:function(t){this.nPopContainer.css({transform:"translate3d(0,100%,0)","-webkit-transform":"translate3d(0,100%,0)",opacity:0}),setTimeout($.proxy(function(){$("body").css("padding",this.bodyPadding),this.onAfterPopupHide()},this),this.animationTime)}});return e}),define("wap/components/uploader/photo_uploader",[],function(){var t=function(){},e=function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var t=document.createElement("input");return t.type="file",!t.disabled},i=Backbone.View.extend({initialize:function(e){this.nInput=this.$("input"),this.nUploader=this.$("button"),this.onValidUpload=e.onValidUpload||function(){return!0},this.onStartReadFile=e.onStartReadFile||t,this.onFinishReadFile=e.onFinishReadFile||t,this.onBeforeUpload=e.onBeforeUpload||t,this.onUploadSuccess=e.onUploadSuccess||t,this.onUploadError=e.onUploadError||t},events:{"click input":"onInputClicked","change input":"onFileChanged"},render:function(t){e()||this.nUploader.css("padding-left","10px").html("您的浏览器不支持图片上传").attr("disabled","disabled")},onInputClicked:function(){},onFileChanged:function(t){var e=this,i=t.target.files;_.map(i,function(t,i,n){if(e.onValidUpload({file:t})){e.onStartReadFile({file:t});var s=new FileReader;s.onload=function(i){e.onFinishReadFile({src:i.target.result,file:t})},s.readAsDataURL(t),e.getUploadToken(t)}})},getUploadToken:function(t){var e=this;return this.uptoken?void this.doUploadPhoto(t):void $.ajax({url:window._global.url.wap+"/common/qiniu/upToken.jsonp",type:"get",dataType:"jsonp",timeout:5e3,cache:!1,data:{scope:window._global.js.qn_public},beforeSend:function(){},success:function(i){e.uptoken=i.data.uptoken,e.doUploadPhoto(t)},error:function(t,e,i){},complete:function(t,e){}})},doUploadPhoto:function(t){var e=this,i=new FormData;i.append("token",this.uptoken),i.append("file",t);var n=t.name.split("."),s="";n.length>1&&(s="."+n[n.length-1]),i.append("x:ext",s),$.ajax({url:"http://up.qiniu.com",type:"post",data:i,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){e.onBeforeUpload({file:t}),e.nInput.data("uploaded","false")},success:function(i){e.onUploadSuccess({url:i.data.attachment_full_url,file:t}),e.nInput.data("value",i.data.attachment_full_url),e.nInput.data("uploaded","true")},error:function(i,n,s){e.onUploadError({file:t})},complete:function(t,e){}})}});return i}),window.Utils=window.Utils||{},$.extend(window.Utils,{validMobile:function(t){return t=""+t,/^((\+86)|(86))?(1)\d{10}$/.test(t)},validPhone:function(t){return t=""+t,/^0[0-9\-]{10,13}$/.test(t)},validNumber:function(t){return/^\d+$/.test(t)},validEmail:function(t){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(t)},validPostalCode:function(t){return t=""+t,/^\d{6}$/.test(t)}}),define("wap/components/util/valid",function(){}),define("text!wap/showcase/sku/templates/message.html",[],function(){return'<% if(messages.length !== 0) {%>\n    <div class=\'sku-message\'>\n        <% for (var j = 0, len = messages.length; j < len; j++) { %>\n        <dl class="clearfix">\n            <dt class="pull-left">\n                <label for="ipt-<%=j %>"><% if (messages[j].required == \'1\') { %><sup class="required">*</sup><% } %><%=messages[j].name %></label>\n            </dt>\n            <dd class="comment-wrapper clearfix">\n                <% if (messages[j].multiple == \'0\') { %>\n                    <% if (messages[j].type == \'image\') { %>\n                        <input data-valid-type="<%=messages[j].type %>" <% if (messages[j].required == \'1\') { %>required<% } %> tabindex="<%=j + 1 %>" id="ipt-<%=j %>" name="message_<%=j %>" type="file" capture="camera" accept="image/*" class="js-message photo-input" >\n                        <button class="btn btn-white image-input-trigger pull-right">拍照&nbsp;或&nbsp;选择相片</button>\n                        <div class=\'image-input-show clearfix\'>\n                            <img class="hide" width=50 height=50 />\n                        </div>\n                    <% }else { %>\n                        <input data-valid-type="<%=messages[j].type %>" <% if (messages[j].required == \'1\') { %>required<% } %> tabindex="<%=j + 1 %>" id="ipt-<%=j %>" name="message_<%=j %>" type="<%=messages[j].type %>" class="txt js-message font-size-14" />\n                    <% } %>\n                <% } else { %>\n                <textarea data-valid-type="<%=messages[j].type %>" <% if (messages[j].required == \'1\') { %>required<% } %> tabindex="<%=j + 1 %>" id="ipt-<%=j %>" name="message_<%=j %>" cols="32" rows="1" class="txta js-message font-size-14"></textarea>\n                <% } %>\n                <% if (messages[j].type != \'image\' && (isIOS || (messages[j].type != \'date\' && messages[j].type != \'time\'))) { %>\n                    <div class=\'txtCover\'></div>\n                <% } %>\n            </dd>\n        </dl>\n        <% } %>\n    </div>\n<% } %>\n'}),define("wap/showcase/sku/views/message",["wap/components/uploader/photo_uploader","wap/components/util/valid","text!wap/showcase/sku/templates/message.html"],function(t,e,i){var n=window.zenjs.UA,s=n&&n.isIOS(),o=Backbone.View.extend({template:_.template(i),initialize:function(t){this.messages=this.options.messages||[]},events:{"click .txtCover":"txtFocus","blur .txt,.txta":"txtBlur"},txtFocus:function(t){var e=$(t.target),i=e.parent().find(".txt,.txta");i.focus(),s&&n.getIOSVersion()<8&&(i.blur(),i.focus()),e.parent().find(".txta").attr("rows","2"),e.css("display","none")},txtBlur:function(t){var e=$(t.target);e.parent().find(".txtCover").css("display","block"),e.hasClass("txta")&&e.attr("rows","1")},render:function(){this.$el.html(this.template({messages:this.messages,isIOS:s})),0===this.messages.length&&this.$el.hide();var e=this.$(".photo-input");return this.photoUploaders=[],e.each(_(function(e,i){var n=$(i).parent(),s=n.find("img"),o=n.find("button"),a=new t({el:n,onFinishReadFile:function(t){s.removeClass("hide").attr("src",t.src)},onBeforeUpload:function(){o.html("正在上传...")},onUploadSuccess:function(t){s.removeClass("hide").attr("src",t.url+"!100x100.jpg"),o.html("修改")},onUploadError:function(){o.html("重新上传")}}).render();this.photoUploaders.push(a)}).bind(this)),s||this.$el.find("input[type=date], input[type=time]").on("mouseover mousedown touchstart touchmove touchend touchcancel",function(t){t.stopPropagation()}),this},validate:function(t){for(var e,i,n,s,o=this,a=this.messages,r=0,d=a.length;d>r;r++)if(e="message_"+r,i=t[e],n=a[r],_.isEmpty(i)){if("1"==n.required)return o.$el.find("#ipt-"+r).focus(),motify.log("image"==n.type?"请上传 "+n.name+"。":"请填写 "+n.name+"。"),!1}else{if("image"==n.type&&(s=o.$el.find("#ipt-"+r).data("uploaded"),"false"==s||!s))return motify.log("图片还在上传中，请稍等。。"),!1;if("tel"==n.type&&!Utils.validNumber(i))return o.$el.find("#ipt-"+r).focus(),motify.log("请填写正确的"+n.name+"。"),!1;if("email"==n.type&&!Utils.validEmail(i))return o.$el.find("#ipt-"+r).focus(),motify.log("请填写正确的"+n.name+"。"),!1}return!0},getData:function(){var t={};return this.$("dl .js-message").each(function(e,i){if("file"==i.type)var n=$(i).data("value");t[i.name]=n||i.value||""}),this.validate(t)?t:null}});return o}),define("text!wap/showcase/goods/templates/present_sku.html",[],function(){return'<!-- <div class="layout-title sku-box-shadow name-card sku-name-card">\n    <div class="thumb"><img src="/micro/pub/img/pic/FtZUJNm6bg4d.jpg" alt=""></div>\n    <div class="detail goods-base-info clearfix">\n        <p class="title c-black ellipsis">我很便宜</p>\n        <div class="goods-price clearfix">\n            <div class="current-price c-black pull-left">\n                <span class="price-name pull-left font-size-14 c-orange">￥</span><i class="js-goods-price price font-size-18 c-orange vertical-middle">0.01</i>\n            </div>\n        </div>\n    </div>\n    <div class="js-cancel sku-cancel">\n        <div class="cancel-img"></div>\n    </div>\n</div> -->\n\n<div class="adv-opts layout-content">\n    <div class="goods-models js-sku-views block block-list block-border-top-none">\n    </div>\n    <div class="confirm-action content-foot">\n        <a href="javascript:;" class="js-sku-get-present btn btn-block btn-green">领取赠品</a>\n    </div>\n</div>\n'}),define("wap/showcase/goods/views/present_sku",["wap/showcase/sku/views/message","text!wap/showcase/goods/templates/present_sku.html"],function(t,e){return Backbone.View.extend({events:{"click .js-sku-get-present":"_onGetPresentClicked","click .js-cancel":"_onCancelClicked"},initialize:function(t){t=t||{},this.messages=t.messages||[],this.onHide=t.onHide||function(){},this.onGetPresentClicked=t.onGetPresentClicked},render:function(){return this.$el.html(e),this.nSkuContainer=this.$(".js-sku-views"),this.messageView=new t({messages:this.messages,className:"block-item block-item-messages"}),this.nSkuContainer.append(this.messageView.render().el),this},_onGetPresentClicked:function(){var t=this.messageView.getData();t&&this.onGetPresentClicked({postData:t})},_onCancelClicked:function(t){this.onHide()}})}),define("wap/components/popout",["wap/components/pop"],function(t){var e=t.extend({init:function(t){t=t||{},this._super(t),this.css=$.extend({position:"absolute","z-index":1e3,transition:"opacity ease "+this.animationTime+"ms",opacity:0,top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},t.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(t){this.nPopContainer.css({opacity:0})}});return e}),define("wap/components/popout_box",["wap/components/popout"],function(t){var e=function(){},i=t.extend({init:function(t){this._super(t),this._onOKClicked=t.onOKClicked||e,this._onCancelClicked=t.onCancelClicked||e,this.preventHideOnOkClicked=t.preventHideOnOkClicked||!1,this.width=t.width,this.setEventListener()},setEventListener:function(){this.nPopContainer.on("click",".js-ok",$.proxy(this.onOKClicked,this)),this.nPopContainer.on("click",".js-cancel",$.proxy(this.onCancelClicked,this))},_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"270px",padding:"15px"},this.nPopContainer.css(this.boxCss).addClass("popout-box"),this._super()},_doHide:function(t){this._super()},onOKClicked:function(t){this._onOKClicked(t),!this.preventHideOnOkClicked&&this.hide()},onCancelClicked:function(t){this._onCancelClicked(t),this.hide()}});return i}),define("text!wap/components/pop_alert/box.html",[],function(){return'<div class="alert-content" style="line-height: 120%;">\n	<%= data.box_content %>\n</div>\n<hr style="margin: 10px 0 11px;">\n<p class="js-ok confirm center c-green">\n	<%= data.box_confirm %>\n</p>'}),window.zenjs=window.zenjs||{},function(t){var e=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},e=["&","<",">",'"',"'"],i=new RegExp("["+e.join("")+"]","g");return function(e){return null==e?"":(""+e).replace(i,function(e){return t[e]})}}(),i={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},n=/(.)^/,s={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},o=/\\|'|\r|\n|\t|\u2028|\u2029/g,a=function(t,a,r){var d;r=$.extend({},i,r);var l=new RegExp([(r.escape||n).source,(r.interpolate||n).source,(r.evaluate||n).source].join("|")+"|$","g"),c=0,h="__p+='";t.replace(l,function(e,i,n,a,r){return h+=t.slice(c,r).replace(o,function(t){return"\\"+s[t]}),i&&(h+="'+\n((__t=("+i+"))==null?'':escapeFunc(__t))+\n'"),n&&(h+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),a&&(h+="';\n"+a+"\n__p+='"),c=r+e.length,e}),h+="';\n",r.variable||(h="with(obj||{}){\n"+h+"}\n"),h="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+h+"return __p;\n";try{d=new Function(r.variable||"obj","escapeFunc",h)}catch(u){throw u.source=h,u}if(a)return d(a,e);var p=function(t){return d.call(this,t,e)};return p.source="function("+(r.variable||"obj")+"){\n"+h+"}",p};return window.zenjs.template=a}(window.zenjs),define("components/zenjs/util/template",function(){}),define("wap/components/pop_alert/popout_alert",["wap/components/popout_box","text!wap/components/pop_alert/box.html","components/zenjs/util/template"],function(t,e){var i=window.zenjs.template(e),n=t.extend({init:function(t){this._super(t),this.isCanNotHide=!0,this.box_content=t.content||"",this.box_confirm=t.confirmText||"我知道了"},render:function(t){return this.html||(this.html=i({data:{box_content:this.box_content,box_confirm:this.box_confirm}})),this._super(t),this.nPopContainer.addClass("popout-alert"),this},_doShow:function(){this._super()},_doHide:function(t){this._super()}}),s=null;return{show:function(t,e){e=e||{},s&&this.hide(),e.content=t,s=new n(e).render().show()},hide:function(){s&&(s.hide(),s=null)}}}),define("wap/showcase/goods/views/store_info",["wap/components/pop_alert/popout_alert"],function(t){return Backbone.View.extend({initialize:function(t){},events:{"click .js-rz-item-alert":"rz_alert"},render:function(t){return this},rz_alert:function(){var e={is_secured_transactions:"该笔订单享受有赞提供的全程消费保障，请放心购买",team_certificate_person:"该店铺已通过有赞个人认证，请放心购买",team_certificate_company:"该店铺已通过有赞企业认证，请放心购买"};return function(i){var n=$(i.target);n.hasClass("js-rz-item-alert")||(n=n.parents(".js-rz-item-alert"));var s=n.data("type"),o=e[s]||"";o&&t.show(o)}}()})}),window.zenjs=window.zenjs||{},function(t){t.Event={getTargetByDataKey:function(t,e){for(var i=$(t.target);!i.data(e)&&"BODY"!=(i[0]||{}).nodeName;)i=i.parent();return i},getEventHandler:function(){var e=function(){};return $.extend(!0,e.prototype,t.Event.methods),new e},methods:{events:{},on:function(t,e){return"string"!=typeof t||"[object Function]"!==Object.prototype.toString.call(e)?!1:(this.events[t]||(this.events[t]=[]),this.events[t].push(e))},trigger:function(t){if("string"!=typeof t)return!1;if(!this.events[t])return this.events[t]=[],!1;for(var e=this.events[t],i=Array.prototype.slice.apply(arguments,[1]),n=0,s=e.length;s>n;n++)e[n](i)},off:function(t,e){if(!t&&!e)return void(this.events={});if(!e)return void(this.events[t]=[]);var i=this.events[t],n=i.indexOf(e);i.splice(n,1)}}}}(window.zenjs),define("components/zenjs/util/event",function(){}),define("components/zenjs/backbone/tabber",["components/zenjs/util/event","backbone"],function(t,e){var i=window.zenjs.Event,n=function(){},s=e.View.extend({initialize:function(t){this.activeKey=t.activeKey||"type",this.activeClass=t.activeClass||"active",this.cbOnClicked=t.onClicked||n,this.cbOnDisabledClicked=t.onDisabledClicked||n,this.initDefault(t)},events:{click:"onClicked"},initDefault:function(t){t.defaultData&&t.defaultData.length>0&&this.active(t.defaultData)},onClicked:function(t){if(t.target&&0!==t.target.length){var e=i.getTargetByDataKey(t,this.activeKey),n=""+e.data(this.activeKey);if(e.blur(),this.activeData!==n&&n&&n.length>0){if(this.disabled===!0)return void(this.activeData!==n&&this.cbOnDisabledClicked());this.$("."+this.activeClass).removeClass(this.activeClass),e.addClass(this.activeClass),this.activeData=n,this.cbOnClicked(_.extend(t||{},{value:n,nTarget:e}))}}},active:function(t,e){this.onClicked(_.extend({target:this.$el.find("[data-"+this.activeKey+'="'+t+'"]:first')},e||{}))},setDisable:function(t){this.disabled=t},setData:function(t){this.activeData=t,this.$("."+this.activeClass).removeClass(this.activeClass),this.$el.find("[data-"+this.activeKey+'="'+this.activeData+'"]:first').addClass(this.activeClass)},getData:function(){return this.activeData}});return s}),define("wap/components/waterfall/pager",["components/zenjs/class"],function(t){var e=function(){};return t.extend({init:function(t){this.$el||(this.$el=$(t.el||t.$el||"<div></div>"),this.el=this.$el[0]),t.total&&(this.total=t.total),this.offset=t.offset||300,this.scrollDirection="down",this.pageIndex=t.pageIndex||0,this.idName=t.idName||"id",t.idValue&&(this.idValue=t.idValue),this.getExtrPostData=t.getExtrPostData||e,this.perPage=t.perPage||10,this.jsonKeys=t.jsonKeys||{},this.finishedHTML=t.finishedHTML,this.finishedText=t.finishedText,this.postData=t.postData||{},this.onFinished=t.onFinished||e,this.nLoading=t.loadingHTML?$(t.loadingHTML).addClass("loading-more"):$('<div class="loading-more"><span></span></div>'),this.nList=this.$el.find(".js-list"),0==this.nList.length&&(this.nList=$('<div class="js-list b-list"></div>'),this.$el.append(this.nList)),this.listEl=this.nList,this.$el.append(this.listEl),this.onFetchError=t.onFetchError||e,$(window).on("scroll",$.proxy(this.onScroll,this))},onScroll:function(){var t=parseInt($(window).height());return function(){if(!(this.sleeping||this.finished||this.fetching)){var e=this,i=parseInt($(document.body).height()),n=$(document.body).scrollTop();if(this.total&&this.total<=this.pageIndex*this.perPage)return void this.doFinishLoading();"down"==this.scrollDirection&&i-t-n<this.offset&&e.fetchMore&&e.fetchMore(),"up"==this.scrollDirection&&this.scrollContainer.scrollTop()<this.offset&&e.fetchMore&&e.fetchMore()}}}(),fetchMore:function(){return this.sleeping||this.finished||this.fetching?this:(this.showLoading(),this.fetching=!0,this._fetchMore&&this._fetchMore.call(this),this)},onFetchMoreSuccess:function(){this.hideLoading(),this.fetching=!1,this._onFetchMoreSuccess.apply(this,arguments)},fetchRender:function(){return this.fetchMore(),this},_onFetchMoreError:function(){this.fetching=!1,this.hideLoading(),this.onFetchError()},doFinishLoading:function(){this.finished=!0,this.fetching=!1,this.hideLoading(),this.$el.find(".list-finished").remove(),this.triggerMethod&&this.triggerMethod("finished",this.collection)},doSleep:function(){this.sleeping=!0},doWake:function(){this.sleeping=!1,this.fetchMore()},showLoading:function(){this.hasFetching=!0,this.$el.append(this.nLoading)},hideLoading:function(){this.nLoading.remove()},getFinishHtml:function(){var t;return t=this.finishedHTML?$(this.finishedHTML).addClass("list-finished"):'<div class="list-finished">'+(this.finishedText||"已经没有更多了")+"</div>"},resetWaterfall:function(){this.nList.empty(),this.listEl.empty(),this.finished=!1,this.pageIndex=0,this.$(".list-finished").remove(),this.collection&&this.collection.reset([]),this.idValue=void 0,this.onScroll()},_onListEmpty:function(){if(!this.fetching){var t;this.emptyHTML?t=$(this.emptyHTML).addClass("list-finished"):this.emptyText&&(t='<div class="list-finished">'+this.emptyText+"</div>"),this.$el.append(t)}}})}),define("components/zenjs/backbone/base_view",["components/zenjs/core/trigger_method"],function(t){return Backbone.View.extend({clean:function(){return this.stopListening(),this},triggerMethod:t})}),define("components/zenjs/list/list",["components/zenjs/backbone/base_view"],function(t){var e=function(){};return t.extend({initialize:function(t){return this.options=t=t||{},this.items=[],this.itemView=t.itemView,this.itemOptions=t.itemOptions||{},this.collection=t.collection,this.onAfterListChange=t.onAfterListChange||e,this.onAfterListLoad=t.onAfterListLoad||e,this.onAfterListDisplay=t.onAfterListDisplay||e,this.onListEmpty=t.onListEmpty||t.onEmptyList,this.onItemClick=t.onItemClick||e,this.onViewItemAdded=t.onViewItemAdded||e,this.displaySize=t.displaySize||-1,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"列表为空",this._setupListeners(),this.on("list:empty",_(this._onListEmpty).bind(this)),this},render:function(t){return this.displaySize=-1==(t||{}).displaySize?-1:this.displaySize,this.clean(),this._setupListeners(),this.addAll(),this.onAfterListDisplay({list:this.collection}),this},fetchRender:function(t){return this.collection.fetch({data:t,success:_(function(t,e){this.render(),this.onAfterListLoad(this.collection,e),this.onFetchSuccess&&this.onFetchSuccess()}).bind(this)}),this},_setupListeners:function(){this.collection&&(this.listenTo(this.collection,"add",this.addItem,this),this.listenTo(this.collection,"reset sort",this.render,this),this.listenTo(this.collection,"remove",this.onItemRemoved,this))},addItemListeners:function(t){var e=this;this.listenTo(t,"all",function(){var e="item:"+arguments[0],i=_.toArray(arguments);i.splice(0,1),i.unshift(e,t),this.trigger.apply(this,i),"item:click"==e&&this.onItemClick()}),this.listenTo(t.model,"change",function(){e.onAfterListChange({list:this.collection})})},addAll:function(){0===this.collection.length?this.fetching||this.triggerMethod("list:empty"):this.collection.each(function(t){this.addItem(t)},this)},removeAll:function(){var t=this;_.each(this.items,function(e){t.removeView(e)}),this.onAfterListChange({list:this.collection})},addItem:function(t){if(!(this.displaySize>=0&&this.items.length>=this.displaySize)){1==this.collection.length&&(this.listEl||this.$el).html("");var e=new this.itemView(_.extend({},this.options.itemOptions,{model:t,index:this.collection.indexOf(t)}));return this.items.push(e),this.addItemListeners(e),e.render(),this.onViewItemAdded({list:this.items,viewItem:e}),(this.listEl||this.$el).append(e.el),e}},removeItem:function(t){var e=this.getViewByModel(t);e&&this.removeView(e)},removeView:function(t){var e;this.stopListening(t),t&&(this.stopListening(t.model),t.remove(),e=this.items.indexOf(t),this.items.splice(e,1)),0===this.collection.length&&(this.fetching||this.triggerMethod("list:empty"))},onItemRemoved:function(t){this.removeItem(t),this.onAfterListChange()},getViewByModel:function(t){return _.find(this.items,function(e,i){return e.model===t})},dispatchEventToAllViews:function(t,e){for(var i=this.items.length-1;i>=0;i--)this.items[i].trigger(t,e)},remove:function(){t.prototype.remove.call(this,arguments),this.removeAll(),this.collection.reset(),delete this.collection},clean:function(){t.prototype.clean.call(this,arguments),this.removeAll(),(this.listEl||this.$el).html(""),this.stopListening(this.collection)},_onListEmpty:function(){this.$el.html(this.emptyHTML||(this.emptyText?'<p style="text-align:center;line-height:60px;">'+this.emptyText+"</p>":""))}})}),define("wap/components/waterfall/waterfall",["wap/components/waterfall/pager","components/zenjs/list/list"],function(t,e){delete t.prototype.constructor;var i=e.extend(t.prototype),n=i.extend({initialize:function(t){e.prototype.initialize.apply(this,[t]),i.prototype.init.apply(this,[t]),this.on("finished",this._doFinishLoading)},_fetchMore:function(){var t={};this.idValue&&(t[this.idName]=this.idValue),t[this.jsonKeys.perPage||"perpage"]=this.perPage,t[this.jsonKeys.pageIndex||"page"]=this.pageIndex+1,this.collection.fetch({data:$.extend(t,this.postData),success:$.proxy(this.onFetchMoreSuccess,this),error:$.proxy(this.onFetchError,this),update:!0,remove:!1})},_onFetchMoreSuccess:function(t,e){if(this.pageIndex++,this.triggerMethod("after:list:load",{collection:t,response:e}),this.collection.parse(e).length<this.perPage)return void this.doFinishLoading();var i=_.last(this.collection.models);i&&(this.idValue=i.get(this.idName)),this.onScroll()},_onAfterListLoad:function(){var t=_.last(this.collection.models);t&&(this.idValue=t.get(this.idName))},_doFinishLoading:function(){if(this.collection.length>0){if(this.hasFetching&&this.pageIndex>1){var t=this.getFinishHtml();this.$el.append(t)}}else this.triggerMethod("list:empty")}});return n}),define("wap/components/waterfall/collections/collection",["require","exports","module"],function(t,e,i){i.exports=Backbone.Collection.extend({parse:function(t){var e=(t||{}).data||{},i=e.list||[];return this.total=parseInt(e.total||e.count),i}})}),define("text!wap/showcase/goods/templates/trade_record.html",[],function(){return'<span class="col-1 c-gray-darker"><%= data.nickname %></span>\n<span class="col-2 c-gray-darker"><%= data.item_num %></span>\n<span class="col-3 c-gray-dark"><%= data.update_time %></span>\n'}),define("wap/showcase/goods/views/trade_record_item",["text!wap/showcase/goods/templates/trade_record.html"],function(t){return Backbone.View.extend({template:_.template(t),className:"block-item",render:function(){this.$el.html(this.template({data:this.model.toJSON()}))}})}),define("wap/showcase/goods/views/goods_detail",["components/zenjs/backbone/tabber","wap/components/waterfall/waterfall","wap/components/waterfall/collections/collection","wap/showcase/goods/views/trade_record_item"],function(t,e,i,n){var s=window._global;return Backbone.View.extend({initialize:function(t){this.tradeRecordWaterfall=null,this.asyncs=t.asyncs,this.goodsDetailMap=[],this.goodsDetailMap.push({type:"goods",desc:"商品详情"});var e=t.sold_num||0,i=t.buy_record||!1;e>0&&i&&this.goodsDetailMap.push({type:"sales",desc:"本店成交"});
},render:function(){var t=this;return this.asyncs.goods_detail?(window.queryBatch&&window.queryBatch({key:"goods_detail",url:"/v2/showcase/goods/goodsDetail.json?alias="+window._global.alias,para:{},type:"POST",handler:_(function(e){var i=e.data||{},n=i.html,s=i.js_config||[];t.$el.append(n),t.nTabberContainer=t.$(".js-tabber-container"),t.nTabber=t.$(".js-tabber"),t.nTabberContent=t.$(".js-tabber-content"),t.initGoodsDetailTabber();var o=Logger&&Logger.getSpm()||"";t.$(".js-lazy").lazyload({threshold:200}),t.$(".js-goods-lazy").lazyload({threshold:200,appear:function(){var t,e=$(this).parents(".js-goods").first().data("goods-id");t=o.lastIndexOf("_")===o.length-1?o+"SI"+e:o+"_SI"+e,Logger&&Logger.log({spm:t,fm:"display"})}}),window.initSwiper&&window.initSwiper(t.$el);var a,r=[];_.each(s,function(t){t&&(a=document.createElement("script"),a.type="text/javascript",a.charset="utf-8",a.async=!0,a.src=t,r.push(a))}),t.$el.append(r),window.imagePreview&&window.imagePreview.init()}).bind(this)}),this):(t.nTabberContainer=t.$(".js-tabber-container"),t.nTabber=t.$(".js-tabber"),t.nTabberContent=t.$(".js-tabber-content"),this.initGoodsDetailTabber(),window.imagePreview&&window.imagePreview.init(),this)},initGoodsDetailTabber:function(){if(this.goodsDetailMap.length<2||!this.asyncs.tabber)return this.nTabberContent.find(".js-part").removeClass("hide"),this;var e=window.zenjs.Args.get("type")||"goods";this.tabber=new t({el:this.nTabber,activeClass:"active",activeKey:"type",defaultData:e,onClicked:_(this.onTabberClicked).bind(this)})},onTabberClicked:function(t){var o=t.value,a=this.nTabberContent.find(".js-part[data-type="+o+"]");this.nTabberContent.find(".js-part").addClass("hide"),a.removeClass("hide"),this.activeContent=a,"sales"!==o||this.tradeRecordWaterfall||(this.tradeRecordWaterfall=new e({el:$(".js-traderecord-list"),collection:new i([],{url:"/v2/trade/order/orderitemlist.json?alias="+s.alias}),itemView:n,emptyText:"最近暂无成交",onListEmpty:_(function(){this.nTabberContainer.addClass("empty")}).bind(this)}).fetchRender())}})}),define("text!wap/showcase/goods/templates/cashback_rule.html",[],function(){return'<form class="form-dialog">\n    <div class="header">\n        <h2> <span>促销详情</span> </h2>\n    </div>\n    <fieldset class="field-info" style="line-height: 120%;">\n        <% if(cashBack && cashBack.replace(/(^\\s*)|(\\s*$)/g, "")){ %>\n        <p class="font-size-12"><span class="c-red">【订单返现】</span><span><%= cashBack %></span>返现；</p>\n        <div class="turn-rule-step">\n            <p class="font-size-12 c-gray-dark reset-p-margin">1、通过【微信支付】付款，返现金额将通过 【微信退款】发放，请注意查收；</p>\n            <p class="font-size-12 c-gray-dark reset-p-margin">2、通过【银行卡】付款，返现金额将在3天内，原路发放至银行卡账户；</p>\n        </div>\n        <hr>\n        <% } %>\n        <% if(meetReduce && meetReduce.replace(/(^\\s*)|(\\s*$)/g, "")){ %>\n        <p class="font-size-12">\n            <span class="block-icon btn btn-red font-size-14">满减/赠/包邮</span>单笔订单金额<%= meetReduce %>\n        </p>\n        <% } %>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-ok btn btn-green btn-block">我知道了</button>\n    </div>\n</form>\n\n'}),define("wap/showcase/goods/goods",["wap/components/util/wx_info","text!wap/showcase/goods/templates/goodsCount.html","components/zenjs/util/count_down","wap/components/popup","wap/showcase/goods/views/present_sku","wap/components/popout_box","wap/showcase/goods/views/store_info","wap/showcase/goods/views/goods_detail","text!wap/showcase/goods/templates/cashback_rule.html"],function(t,e,i,n,s,o,a,r,d){var l=window._global,c=Backbone.View.extend({el:"body",cashBackRuleTpl:_.template(d),events:{"click .js-add-cart":"onAddCartClicked","click .js-buy-it":"onBuyItClicked","click .js-add-gift":"onGiftClicked","click .js-trade-reward":"onRewardArrowClicked","click .js-add-wish":"onAddWishClicked","click .js-add-wish-btn":"onAddWishClicked","click .js-added-wish-btn":"onAddedWishClicked","click .js-get-present":"onGetPresent","click .js-promotion-rule":"onShowCashbackRule"},initialize:function(t){var e=this;this.buyConfig=t.buyConfig;this.sku=l.sku;return this.goodsId=l.goods_id,this.activityAlias=l.activity_alias,this.fullPage=this.$(".wap-page-goods"),this.imageSwiper=this.$(".js-image-swiper"),this.taoInfo=this.$(".custom-go-tao"),this.returnBtn=this.$(".js-butn-return"),this.buyBtn=this.$(".js-buy-it"),this.confirmBtn=this.$(".js-confirm-it"),this.componentsContainer=this.$(".js-components-container"),this.bottomOpts=this.$(".js-bottom-opts"),this.buyGuide=this.$(".js-buy-guide"),this.nAddWish=this.$(".js-add-wish"),this.nAddWishBtn=this.$(".js-wish-btn"),this.nVipWishBtnGroup=this.$(".js-wish-btn-group"),this.asyncs=t.asyncMap||{},this.storeInfoView=new a({el:this.$(".js-store-info")}).render(),this.goodsDetailView=new r({el:this.$(".js-detail-container"),sold_num:(l.sku||{}).sold_num,buy_record:l.buy_record,asyncs:this.asyncs}).render(),l.isWishOpen?void(window.queryBatch&&window.queryBatch({key:"goods_wish",url:"/v2/trade/wish/IsAdded.json?kdt_id="+l.kdt_id||0,type:"POST",para:{goods_ids:[this.goodsId]},handler:function(t){var i=t.code,n=(t.data||{})[e.goodsId]||{};t.msg;0==i&&(e.nVipWishBtnGroup.length&&(e.nVipWishBtnGroup.removeClass("hide"),n.isWishAdded&&e.nAddWishBtn.addClass("js-added-wish-btn").removeClass("js-add-wish-btn").text("请TA来买单")),n.isWishOpen&&e.nAddWish.removeClass("hide"),n.isWishAdded&&e.nAddWish.addClass("wish-added"))}})):this},initCountdown:function(){var t=this,n=$(".js-mini-counter");if(n.length){var s=new i;s.run({seconds:n.data("countdown"),onTimeChange:function(t){n.html(_.template(e)({data:t||{}}))},step:"second",onTimeChangeEnd:function(){t.$(".js-info-wrapper").hide(),t.$(".js-to-start").addClass("hide"),t.$(".js-normal-btns").removeClass("hide")}})}},buyAction:function(t){if(this.buyConfig){Utils.getWxInfo()||{};return this.buyConfig.isAdmin&&!this.buyConfig.isMobile?(motify.log("预览不支持进行购买，<br />实际效果请在手机上进行。",0),!1):this.buyConfig.no_fans_buy?(setTimeout(function(){window.showGuide&&window.showGuide("follow",{goods:!0})},400),!1):void this.trigger(t)}},onRewardArrowClicked:function(t){var e=this.$(".js-arrow-down");e.hasClass("arrow-down")?(e.removeClass("arrow-down"),this.$(".js-trade-reward-info").addClass("hide-part-text")):(e.addClass("arrow-down"),this.$(".js-trade-reward-info").removeClass("hide-part-text"))},onBuyItClicked:function(t){return t.preventDefault(),t.stopPropagation(),$(t.target).prop("disabled")?!1:void this.buyAction("buy")},onAddCartClicked:function(t){return t.preventDefault(),t.stopPropagation(),$(t.target).prop("disabled")?!1:void this.buyAction("addcart")},onAddWishClicked:function(t){t.preventDefault(),t.stopPropagation();var e=this;this.nAddWish.hasClass("wish-added")?($.ajax({url:"/v2/trade/wish/list.json?kdt_id="+l.kdt_id,type:"DELETE",dataType:"json",cache:!1,timeout:15e3,data:{goods_id:this.goodsId},beforeSend:function(){e.isAjaxing=!0},success:function(t){0==t.code?(e.nAddWish.removeClass("wish-added"),motify.log("取消成功"),e.nAddWishBtn.removeClass("js-added-wish-btn").addClass("js-add-wish-btn").text("我想要")):motify.log(t.msg),e.isAjaxing=!1},error:function(t,i,n){e.isAjaxing=!1}}),Logger&&Logger.log({fm:"click",title:"add_wish"})):this.buyAction("add-wish")},onAddedWishClicked:function(){window.location.href=l.url.trade+"/wxpay/wish?kdt_id="+l.kdt_id},onGiftClicked:function(t){t.preventDefault(),t.stopPropagation(),this.buyAction("gift")},onGetPresent:function(t){t.preventDefault(),t.stopPropagation();var e=(l.sku||{}).messages||[],i=this;e.length?new n({contentViewClass:s,className:"sku-layout sku-box-shadow",contentViewOptions:{messages:e,onGetPresentClicked:function(t){i.getPresentToServer(t.postData)}}}).render().show():this.getPresentToServer()},onShowCashbackRule:function(){var t={cashBack:$("#cash-back-str").html().trim(),meetReduce:$("#meet-reduce-str").html().trim()};if(0!==t.cashBack.length||0!==t.meetReduce.length){var e=this.cashBackRuleTpl(t);new o({html:e,transparent:".8"}).render().show()}},getPresentToServer:function(t){var e=window._global,i=e.url.wap+"/trade/order/generateUserPresentOrder.jsonp",n=e.present.alias;$.ajax({url:i,type:"GET",dataType:"jsonp",cache:!1,data:_.extend({},t,{alias:n}),beforeSend:function(){motify.log("提交成功，跳转中…")},success:function(t){var e=t.code;if(0===e){var i=t.data.trade_confirm_url;window.location.href=i}else motify.log(t.msg)},error:function(t){motify.log("请求出错，请重试！")}})},scrollToTitle:function(){var t=$(".custom-go-tao").offset().top;setTimeout(function(){window.scrollTo(0,t)},10)},wishAdded:function(){this.nAddWish.addClass("wish-added"),this.nAddWishBtn.addClass("js-added-wish-btn").removeClass("js-add-wish-btn").text("请TA来买单")},render:function(t){var e=this.$(".js-trade-reward"),i=this.$(".js-trade-reward-info"),n=e.width(),s=$.trim(i.text());return n<75+11*s.length&&this.$(".js-arrow-down").removeClass("hide"),this.initCountdown(),this}});return c}),function(){Date.shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Date.longMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.shortDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Date.longDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var t={d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.shortDays[this.getDay()]},j:function(){return this.getDate()},l:function(){return Date.longDays[this.getDay()]},N:function(){return 0==this.getDay()?7:this.getDay()},S:function(){return this.getDate()%10==1&&11!=this.getDate()?"st":this.getDate()%10==2&&12!=this.getDate()?"nd":this.getDate()%10==3&&13!=this.getDate()?"rd":"th"},w:function(){return this.getDay()},z:function(){var t=new Date(this.getFullYear(),0,1);return Math.ceil((this-t)/864e5)},W:function(){var t=new Date(this.valueOf()),e=(this.getDay()+6)%7;t.setDate(t.getDate()-e+3);var i=t.valueOf();return t.setMonth(0,1),4!==t.getDay()&&t.setMonth(0,1+(4-t.getDay()+7)%7),1+Math.ceil((i-t)/6048e5)},F:function(){return Date.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+1)},M:function(){return Date.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){var t=this.getFullYear(),e=this.getMonth()+1;return 12===e&&(t=t++,e=0),new Date(t,e,0).getDate()},L:function(){var t=this.getFullYear();return t%400==0||t%100!=0&&t%4==0},o:function(){var t=new Date(this.valueOf());return t.setDate(t.getDate()-(this.getDay()+6)%7+3),t.getFullYear()},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return Math.floor(1e3*((this.getUTCHours()+1)%24+this.getUTCMinutes()/60+this.getUTCSeconds()/3600)/24)},g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},u:function(){var t=this.getMilliseconds();return(10>t?"00":100>t?"0":"")+t},e:function(){return/\((.*)\)/.exec((new Date).toString())[1]},I:function(){for(var t=null,e=0;12>e;++e){var i=new Date(this.getFullYear(),e,1),n=i.getTimezoneOffset();if(null===t)t=n;else{if(t>n){t=n;break}if(n>t)break}}return this.getTimezoneOffset()==t|0},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+"00"},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+":00"},T:function(){return this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1")},Z:function(){return 60*-this.getTimezoneOffset()},c:function(){return this.format("Y-m-d\\TH:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1e3}};Date.prototype.format=function(e){var i=this;return e.replace(/(\\?)(.)/g,function(e,n,s){return""===n&&t[s]?t[s].call(i):s})}}.call(this),define("wap/im/helpers/date_format",function(){}),define("wap/im/helpers/utils",["wap/im/helpers/date_format"],function(){var t=window.Utils||{};return _.extend(t,{getToken:function(){return window._global.open_token?window._global.open_token.access_token:""},getCardData:function(){var t=window._global.card_data||{};return t},getUserInfo:function(){var t=window._global.mp_data||{},e={pic:t.logo||"",name:t.team_name||""};return e},isRetina:function(){return window.devicePixelRatio>1},dateFormat:function(t,e){if(!t)return"";var i=new Date(t),n=i.format(e);return n},notInIframe:function(){var t=window.top===window;return t},deparam:function(t){var e={};if(!t)return e;var i=t.split("&");return _(i).each(function(t){var i=t.split("=");e[i[0]]=i[1]}),e},rtrim:function(t){return t=t||"",t.replace(/(\s*$)/g,"")},url:function(t){var e=window.location.origin+"/v2",i=e+t;return i},site:function(t,e){var i=window._global.run_mode,n=window._global.url;"static"===e&&"online"===i&&(e="cdn_static");var s=t;return e=e?n[e]||"":"",-1==t.search(/^http[s]?\:\/\//)&&(s=e+t),s},fullfillImage:function(t,e){return t?(e=e||"",t.match(/https?:\/\//i)?t.match(window._global.url.imgqn)?t+e:t:window._global.url.imgqn+"/"+t+e):void 0},ajax:function(t,e){var i=$.Deferred();return"object"==typeof t&&(e=t,t=void 0),e=_.defaults(e||{},{dataType:"json"}),i.xhr=$.ajax(e).done(function(t){void 0!==t.errcode&&(t.code=t.errcode,t.msg=t.errmsg),0===+t.code?i.resolve(t.data,t):void 0===t.code?i.resolve(t,t):i.reject(t.msg,t)}).fail(function(t,e){var n=99999;e=e||"网络错误。","parsererror"===e&&(e="JSON解析失败"),"abort"===e&&(n=-1),i.reject(e,{code:n,msg:e})}),i},insertText:function(t,e){if("INPUT"===t.tagName||"TEXTAREA"===t.tagName)if(document.selection){t.focus();var i=document.selection.createRange();i.text=e,i.collapse(),i.select()}else if(t.selectionStart||"0"==t.selectionStart){var n=t.selectionStart,s=t.selectionEnd;t.value=t.value.substring(0,n)+e+t.value.substring(s,t.value.length),t.selectionStart=t.selectionEnd=n+e.length}else t.value+=e},moveCaretToStart:function(t){if("number"==typeof t.selectionStart)t.selectionStart=t.selectionEnd=0;else if("undefined"!=typeof t.createTextRange){t.focus();var e=t.createTextRange();e.collapse(!0),e.select()}},moveCaretToEnd:function(t){if("number"==typeof t.selectionStart)t.selectionStart=t.selectionEnd=t.value.length;else if("undefined"!=typeof t.createTextRange){t.focus();var e=t.createTextRange();e.collapse(!1),e.select()}}}),t}),define("wap/im/views/bot_base",["wap/im/helpers/utils"],function(t){return Backbone.View.extend({url:"",config:{source:"wap",token:t.getToken()},start:function(){var t=this;return t.checkIsLogin()?t.isPolling?!1:(t.isPolling=!0,void t.polling()):!1},checkIsLogin:function(){var t=this,e=!!t.config.token;return e},polling:function(){var t=this;t.promise=$.ajax({url:t.url,type:"GET",dataType:"json",data:t.getQueryData()}).done(function(e){e.response?(t.trigger("polling:success",e.response),t.restart()):(t.trigger("polling:fail",e.error_response),t.restart(1e4))}).fail(function(){t.trigger("polling:fail"),t.restart(1e4)})},getQueryData:function(){return _.clone(this.config)},restart:function(t){var e=this;t=t||500,e.timer=window.setTimeout(function(){e.polling()},t)},stop:function(){var t=this;t.promise&&t.promise.abort(),t.isPolling=!1,window.clearTimeout(t.timer),t.timer=null}})}),define("wap/im/helpers/local_store",[],function(){function t(){this.data={}}return t.prototype={get:function(t){var e=this.data[t];return e},set:function(t,e){this.data[t]=e},"delete":function(t){var e=this.get(t);return e?(delete this.data[t],e):"STORE_NOT_FOUND"}},window.localStore=window.localStore||new t,window.localStore}),define("text!wap/im/templates/vessel.html",[],function(){return'<iframe id="js-im-vessel" src="about:blank" width="100%" height="100%" frameborder="0"></iframe>\n'}),define("wap/im/views/vessel",["wap/im/helpers/utils","wap/im/helpers/local_store","text!wap/im/templates/vessel.html"],function(t,e,i){return Backbone.View.extend({template:_.template(i),events:{},ui:{},render:function(t){var e=this;return t=t||{},e.$el.html(e.template(t)),e.ui.iframe=e.$("#js-im-vessel"),window.imMainWin=e.imMainWin=e.ui.iframe[0].contentWindow,e},update:function(e){var i=this;setTimeout(function(){var n=window._global.alias,s={talkerId:e,t:+new Date},o="/im?alias="+n+"#talk!"+$.param(s),a=t.url(o,"wap");i.ui.iframe.attr("src",a)},50)},postData:function(t){var e=this;e.imMainWin.postMessage(t,window.location.origin)}})}),define("wap/im/icon",["wap/components/popup","wap/im/helpers/utils","wap/im/views/bot_base","wap/im/views/vessel"],function(t,e,i,n){var s=i.extend({el:"body",events:{"click .js-open-im":"onOpenImClick"},ui:{},initialize:function(){var t=this;t.ui.unreadDot=t.$(".js-unread-dot"),t.url=window._global.url.wap+"/im/api/notify",t.listenTo(t,"polling:success",t.onPollingSuccess)},onPollingSuccess:function(t){var e=this,i=t.total;e.updateCount(i),i>0&&e.stop()},updateCount:function(t){var e=this;t=t&&t>0?t:"",e.ui.unreadDot.text(t)},notifyVessel:function(t){var e=this;return e.popupView?void e.popupView.contentView.postData(t):!1},onOpenImClick:function(e){var i=this;e.preventDefault(),i.popupView||(i.popupView=new t({contentViewClass:n,className:"wap-im-vessel",onShow:function(){i.stop()},onHide:function(){i.notifyVessel({command:"im:close"}),i.updateCount(0),i.start()},onFinishHide:function(){i.popupIsShow=!1},contentViewOptions:{},doNotRemoveOnHide:!0,containerCss:{top:80,padding:0}}).render({}),i.handleMessage()),i.loadMain(),i.popupView.show(),i.popupIsShow=!0},loadMain:function(){var t=this,e=window._global.kdt_id;t.popupView.contentView.update(e)},handleMessage:function(){function t(t){-1!==t.origin.indexOf("hbcnhls.com")&&e.processCommand(t.data)}var e=this;window.addEventListener("message",t)},processCommand:function(t){var e=this,i=t.command;"im:init"===i?e.reSetup(t.data):"im:hide"===i?e.popupView.hide():"bot:config"===i&&e.updateConfig(t.data)},reSetup:function(t){var i=this,n=t.buyer,s=window._global;return s.buyer_id?!1:(s.buyer=n,s.buyer_id=n.id,s.open_token=t.open_token,void i.updateConfig({token:e.getToken()}))},updateConfig:function(t){_(this.config).extend(t)}});return window.imBot=window.imBot||new s,window.imBot}),define("text!wap/showcase/goods/templates/recommend_goods.html",[],function(){return'<div class="js-recommend">\n	<p class="center font-size-14 c-black" style="padding: 5px 0;margin-top: 10px;">更多精选商品</p>\n\n	<div class="js-recommend-goods-list"></div>\n\n	<p class="center" style="margin: 10px 0 20px;">\n	    <a href="<%= window._global.url.wap %>/showcase/homepage?kdt_id=<%= window._global.kdt_id %>" class="center btn btn-white btn-xsmall font-size-14 " style="padding:8px 26px;">进店逛逛></a>\n	</p>\n</div>\n'}),require(["wap/showcase/goods/goods","wap/components/popup","wap/im/icon","text!wap/showcase/goods/templates/recommend_goods.html","components/zenjs/events"],function(t,e,i,n,s){var o=window._global,a={goods:{goods_recommend:!0,tabber:!0,goods_detail:!0},fast_goods_detail:{tabber:!0}},r=Backbone.View.extend({initialize:function(e){var n=this;this.buyConfig={permissions:{wxPay:o.wxpay_env},isAdmin:o.is_owner_team,isMobile:o.is_mobile,team_certificate:o.team_certificate,no_fans_buy:o.no_fans_buy};var r=window._global.page_type||"goods";if(this.asyncs=a[r]||{},this.goodsView=new t({el:$("body"),buyConfig:this.buyConfig,asyncMap:this.asyncs}).render(),window.eventHandler=window.eventHandler||new s,window.eventHandler.on("wish:add",function(){n.goodsView.wishAdded()}),window.imBot=i.start(),this.listenTo(this.goodsView,"buy",this.buy),this.listenTo(this.goodsView,"addcart",this.addCart),this.listenTo(this.goodsView,"gift",this.gift),this.listenTo(this.goodsView,"add-wish",this.addWish),"true"!=zenjs.Args.get("showsku")||o.is_owner_team&&!o.is_mobile||$(".js-bottom-opts button").prop("disabled")||n.buy(),"true"==zenjs.Args.get("dal")){var d=$("a,span");d.click(function(t){return t.preventDefault(),t.stopPropagation(),!1}),d.css("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)")}},render:function(){return this.asyncs.goods_recommend?("wxd"==zenjs.Args.get("kdtfrom")&&window.queryBatch&&queryBatch({key:"goods_recommend",url:"/v2/showcase/goods/recommendgoodslist.json",type:"GET",para:{alias:o.alias,count:10,kdt_id:o.kdt_id},handler:function(t){var e=t.code,i=t.data;if(0==e){var s=i.html||"";if(s){var o=$(_.template(n)());o.find(".js-recommend-goods-list").append(s),o.find(".js-goods-list").css("visibility","visible"),o.find(".js-goods-lazy").lazyload({threshold:200,appear:function(){var t,e=$(this),i=e.parents(".js-goods").first().data("goods-id"),n=Logger.getSpm();t=n.lastIndexOf("_")===n.length-1?n+"SI"+i:n+"_SI"+i,Logger&&Logger.log({spm:t,fm:"display"})}}),$(".content-body").append(o)}}}}),this):this},gift:function(){this.displaySku({isAddCart:!1,isGift:!0})},goods:function(){this.popupView&&this.popupView.hide()},wishAdded:function(){this.goodsView.wishAdded()},buy:function(){this.displaySku({isAddCart:!1,multiBtn:!1})},addCart:function(){this.displaySku({isAddCart:!0,multiBtn:!1})},addWish:function(){this.displaySku({isAddWish:!0,isAddCart:!1,multiBtn:!1})},displaySku:function(t){var i=this;if(window.BuyView){var n=o;this.popupView=new e({contentViewClass:window.BuyView,className:"sku-layout sku-box-shadow",onFinishHide:function(){t.isAddWish&&window.eventHandler&&window.eventHandler.trigger("wishScrollEnd")},contentViewOptions:{logURL:n.logURL,baseUrl:n.url.wap,need_ajax_login:n.need_ajax_login,wxpay_env:n.wxpay_env,isCartBtnHide:n.hide_shopping_cart}}).render({sku:n.sku,isAddCart:t.isAddCart,isAddWish:t.isAddWish,goods_id:n.goods_id,postage:n.postage,activity_alias:n.activity_alias,activity_id:n.activity_id,activity_type:n.activity_type,quota:n.quota,quota_used:n.quota_used,difTitle:!1,acitvity:{},isGift:t.isGift,is_virtual:+o.is_virtual>0}).show()}else setTimeout(function(){i.displaySku(t)},100)}});new r({el:$("body")}).render()}),define("main",function(){});